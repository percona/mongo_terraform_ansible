# mongos.conf - mongos server

# for documentation of all options, see:
#   http://docs.mongodb.org/manual/reference/configuration-options/

# where to write logging data.
systemLog:
  destination: file
  logAppend: true
  logRotate: reopen
  path: {{ mongod_log_path }}/mongos.log

# how the process runs
processManagement:
  fork: true  # fork and run in background
  pidFilePath: /var/run/mongos.pid  # location of pidfile
  timeZoneInfo: /usr/share/zoneinfo

# network interfaces
net:
  port: {{ mongos_port }}
  bindIp: localhost,{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}
{% if use_tls %}
  tls:
    mode: requireTLS
    certificateKeyFile: {{ certificateKeyFile }}
    CAFile: {{ CAFile }}

security:
  clusterAuthMode: x509
{% else %}
security:
  keyFile: {{ keyFile_location }}
{% endif %}

operationProfiling:
   slowOpThresholdMs: 200
#   slowOpSampleRate: 0.1
   rateLimit: 100

sharding:
  configDB: mongo-cfg/{% for h in groups[ 'cfg' ] %}{{ h }}:{{ cfg_server_port }}{% if not loop.last %},{% endif %}{% endfor %}
